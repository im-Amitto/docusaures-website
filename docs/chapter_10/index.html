<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Chapter 10 - Introducing User model · BigBinary</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;A task need to be assigned to a user to get it done.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Chapter 10 - Introducing User model · BigBinary"/><meta property="og:type" content="website"/><meta property="og:url" content="https://im-amitto.github.io/https://im-amitto.github.io/docusaures-website/"/><meta property="og:description" content="&lt;p&gt;A task need to be assigned to a user to get it done.&lt;/p&gt;
"/><meta property="og:image" content="https://im-amitto.github.io/https://im-amitto.github.io/docusaures-website/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://im-amitto.github.io/https://im-amitto.github.io/docusaures-website/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="https://im-amitto.github.io/docusaures-website/img/logo.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="./../css/prism.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="./../js/code-block-buttons.js"></script><script type="text/javascript" src="./../js/prism.js"></script><script type="text/javascript" src="./../js/highlighter.js"></script><link rel="stylesheet" href="https://im-amitto.github.io/docusaures-website/css/main.css"/><script src="https://im-amitto.github.io/docusaures-website/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="https://im-amitto.github.io/docusaures-website/"><img class="logo" src="https://im-amitto.github.io/docusaures-website/img/logo.png" alt="BigBinary"/><h2 class="headerTitleWithLogo">BigBinary</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"></ul></nav></div></header></div></div><div class="navPusher singleRowMobileNav"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Chapters</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/">Introduction</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_0">Installation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Chapters</h3><ul class=""><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_1">Chapter 1 - Building a new Rails application</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_2">Chapter 2 - Task model</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_3">Chapter 3 - Tasks controller</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_4">Chapter 4 - Adding tasks through browser</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_5">Chapter 5 - Show a task</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_6">Chapter 6 - Update the task</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_7">Chapter 7 - Delete the task</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_8">Chapter 8 - Introduction to Validation</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_9">Chapter 9 - Active Record Callbacks and Object Life Cycle</a></li><li class="navListItem navListItemActive"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_10">Chapter 10 - Introducing User model</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_11">Chapter 11 - Authentication</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_12">Chapter 12 - Introduction to Authorization</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_13">Chapter 13 - State Management via Ajax</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_14">Chapter 14 - Adding comments to Tasks</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_15">Chapter 15 - Attaching files</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_16">Chapter 16 - Introduction to Testing and Writing Unit Tests</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter_19">Chapter 19 - Configuring Queue Adapters for Background Processing</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Chapter 10 - Introducing User model</h1></header><article><div><span><p>A task need to be assigned to a user to get it done.
In this chapter we will see how to assign a user to a task.</p>
<h2><a class="anchor" aria-hidden="true" id="101-add-a-user-model"></a><a href="#101-add-a-user-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.1 Add a User model</h2>
<p>Let's create a <code>User</code> model for our application.</p>
<p><code>$ touch app/models/user.rb</code></p>
<p>Add the following lines into the user.rb file and save it.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> &lt; ApplicationRecord</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="102-create-migration"></a><a href="#102-create-migration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.2 Create migration</h2>
<p>Now let's generate a migration so that we have a table named <code>users</code>.</p>
<pre><code class="hljs">$ rails generate migration CreateUser
Running via Spring preloader in process 30090
     <span class="hljs-built_in"> invoke </span> active_record
      create    db/migrate/20190209145206_create_user.rb
</code></pre>
<p>Open the migration file.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateUser</span> &lt; ActiveRecord::Migration[5.2]</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span>
    create_table <span class="hljs-symbol">:users</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|t|</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Now we will add <code>name</code> field with type <code>string</code> into the migration file.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateUser</span> &lt; ActiveRecord::Migration[5.2]</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span>
    create_table <span class="hljs-symbol">:users</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|t|</span>
      t.string <span class="hljs-symbol">:name</span>
      t.timestamps
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

</code></pre>
<p>Now we need to migrate these changes into our database.</p>
<pre><code class="hljs"><span class="hljs-variable">$ </span>rails <span class="hljs-symbol">db:</span>migrate
</code></pre>
<p>Now we have created the User model but till now there is no relationship between <code>User</code> and <code>Task</code> models.
Theoretically, a user can have many tasks.</p>
<p>In order to identify to whom a task is assigned we need to create a new column in <code>tasks</code> table. We will call
this column <code>user_id</code> since it will stored user id of the person to whom the task is assigned.</p>
<p>So let's create a migration to add column <code>user_id</code> to <code>tasks</code> table.</p>
<pre><code class="hljs">$rails <span class="hljs-keyword">generate</span> migration add_user_id_to_tasks
</code></pre>
<p>The migration file will look like this.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddUserIdToTasks</span> &lt; ActiveRecord::Migration[5.2]</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span>
    add_column <span class="hljs-symbol">:tasks</span>, <span class="hljs-symbol">:user_id</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Now we'll add a foreign key constraint to the tasks table so that it has only valid user ids in
<code>user_id</code> column.</p>
<pre><code class="hljs"><span class="hljs-meta"><span class="hljs-meta-keyword">$rails</span> g migration AddForeignKeyToTask</span>
</code></pre>
<p>Add following line to migrated file.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddForeignKeyToTask</span> &lt; ActiveRecord::Migration[5.2]</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span>
    add_foreign_key <span class="hljs-symbol">:tasks</span>, <span class="hljs-symbol">:users</span>, <span class="hljs-symbol">column:</span> <span class="hljs-symbol">:user_id</span>, <span class="hljs-symbol">on_delete:</span> <span class="hljs-symbol">:cascade</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The syntax for add_foreign_key is as following.</p>
<p><code>add_foreign_key(from_table, to_table, options = {})</code>
where <code>from_table</code> is the table with the key column, <code>to_table</code> contains the referenced primary key.
The third parameter is an option which allows us to define our custom name for the column.
The fourth parameter options as <code>on_delete: :cascade</code>. This option makes sure that child objects also get deleted when deleting parent.</p>
<p>Now run db:migrate command to reflect it into the database.</p>
<pre><code class="hljs"><span class="hljs-meta"><span class="hljs-meta-keyword">$rails</span> db:migrate</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="103-defining-associations-betweek-task-and-user-models"></a><a href="#103-defining-associations-betweek-task-and-user-models" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.3 Defining associations betweek Task and User models</h2>
<p>A user can have many tasks assigned to him/her and tasks belong to a user.
Rails provides us an easy way to define such associations.</p>
<p>Add the following line into the <code>user.rb</code> file.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> &lt; ApplicationRecord</span>
  has_many <span class="hljs-symbol">:tasks</span>, <span class="hljs-symbol">dependent:</span> <span class="hljs-symbol">:destroy</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Add the following line into the <code>task.rb</code> file.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> &lt; ApplicationRecord</span>
  belongs_to <span class="hljs-symbol">:user</span>, <span class="hljs-symbol">foreign_key:</span> <span class="hljs-symbol">:user_id</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The <code>dependent: :destroy</code> is a callback and would destroy all the tasks created by a <code>user</code>, if the <code>user</code> is deleted.</p>
<h2><a class="anchor" aria-hidden="true" id="104-create-new-user"></a><a href="#104-create-new-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.4 Create new <code>user</code></h2>
<p>We can perform all CRUD operations for <code>User</code> by defining the routes, controller and views
similar to how we had done in <code>Task</code>.</p>
<p>For now, Let's create user records from Rails console.</p>
<pre><code class="hljs">$ rails<span class="hljs-built_in"> console
</span>
irb(main):004:0&gt; User.create(name: <span class="hljs-string">"Sam"</span>)
   (0.1ms)  begin transaction
 <span class="hljs-built_in"> User </span>Exists (0.2ms)  SELECT  1 AS one <span class="hljs-keyword">FROM</span> <span class="hljs-string">"users"</span> WHERE <span class="hljs-string">"users"</span>.<span class="hljs-string">"name"</span> = ? LIMIT ?  [[<span class="hljs-string">"name"</span>, <span class="hljs-string">"Sam"</span>], [<span class="hljs-string">"LIMIT"</span>, 1]]
 <span class="hljs-built_in"> User </span>Create (0.3ms)  INSERT INTO <span class="hljs-string">"users"</span> (<span class="hljs-string">"name"</span>, <span class="hljs-string">"created_at"</span>, <span class="hljs-string">"updated_at"</span>) VALUES (?, ?, ?)  [[<span class="hljs-string">"name"</span>, <span class="hljs-string">"Sam"</span>], [<span class="hljs-string">"created_at"</span>, <span class="hljs-string">"2019-02-26 19:20:02.451901"</span>], [<span class="hljs-string">"updated_at"</span>, <span class="hljs-string">"2019-02-26 19:20:02.451901"</span>]]
   (189.2ms)  commit transaction
=&gt; #&lt;User id: 1, name: <span class="hljs-string">"Sam"</span>, created_at: <span class="hljs-string">"2019-02-26 19:20:02"</span>, updated_at: <span class="hljs-string">"2019-02-26 19:20:02"</span>&gt;

irb(main):005:0&gt; User.create(name: <span class="hljs-string">"John"</span>)
   (0.2ms)  begin transaction
 <span class="hljs-built_in"> User </span>Exists (0.3ms)  SELECT  1 AS one <span class="hljs-keyword">FROM</span> <span class="hljs-string">"users"</span> WHERE <span class="hljs-string">"users"</span>.<span class="hljs-string">"name"</span> = ? LIMIT ?  [[<span class="hljs-string">"name"</span>, <span class="hljs-string">"John"</span>], [<span class="hljs-string">"LIMIT"</span>, 1]]
 <span class="hljs-built_in"> User </span>Create (0.5ms)  INSERT INTO <span class="hljs-string">"users"</span> (<span class="hljs-string">"name"</span>, <span class="hljs-string">"created_at"</span>, <span class="hljs-string">"updated_at"</span>) VALUES (?, ?, ?)  [[<span class="hljs-string">"name"</span>, <span class="hljs-string">"John"</span>], [<span class="hljs-string">"created_at"</span>, <span class="hljs-string">"2019-02-26 19:20:17.609136"</span>], [<span class="hljs-string">"updated_at"</span>, <span class="hljs-string">"2019-02-26 19:20:17.609136"</span>]]
   (181.1ms)  commit transaction
=&gt; #&lt;User id: 2, name: <span class="hljs-string">"John"</span>, created_at: <span class="hljs-string">"2019-02-26 19:20:17"</span>, updated_at: <span class="hljs-string">"2019-02-26 19:20:17"</span>&gt;
</code></pre>
<p>Similarly, Add user <code>Mary</code> and <code>Jane</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="105-update-new-task-form-to-assign-the-user-to-the-task"></a><a href="#105-update-new-task-form-to-assign-the-user-to-the-task" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.5 Update new task form to assign the user to the task</h2>
<p>Now while creating a task we will assign a user to that task.</p>
<p>Update <code>tasks/new.html.erb</code> file as following:</p>
<pre><code class="hljs"><span class="xml">      .
      .
      .
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Add new Task<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form_for(@task) <span class="hljs-keyword">do</span> <span class="hljs-params">|f|</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.label <span class="hljs-symbol">:description</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.text_field <span class="hljs-symbol">:description</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> collection_select(<span class="hljs-symbol">:task</span>, <span class="hljs-symbol">:assignee_id</span>, User.all, <span class="hljs-symbol">:id</span>, <span class="hljs-symbol">:name</span>) </span><span class="xml"><span class="hljs-tag">%&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> f.submit <span class="hljs-string">"Create Task"</span></span><span class="xml"><span class="hljs-tag">%&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>we have <code>collection_select(:task, :assignee_id, User.all, :id, :name)</code> in the parameters afters sending form we'll get
<code>task</code> as params with attribute <code>assignee_id</code>. We are fetching all options for drop down menu from <code>User.all</code>.
then we are assigning <code>id</code> to <code>_id</code> and we'll display name corresponding to that <code>id</code>.</p>
<p>We can see how <code>collection_select</code> creates dropdown menu in following picture:
<img src="./../img/DropdownMenu.png" alt="alt text"></p>
<h2><a class="anchor" aria-hidden="true" id="107-update-task-controller"></a><a href="#107-update-task-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.7 Update task controller</h2>
<p>Now update create action of task controller as following.</p>
<pre><code class="hljs css language-ruby">.
.

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  @user = User.find(task_params[<span class="hljs-symbol">:assignee_id</span>])
  @task = @user.tasks.new(task_params)

  <span class="hljs-keyword">if</span> @task.valid?
    @task.save
    redirect_to task_url(@task)
  <span class="hljs-keyword">else</span>
    render <span class="hljs-string">'new'</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
.
.
.
private

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">task_params</span></span>
    params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:task</span>).permit(<span class="hljs-symbol">:description</span>, <span class="hljs-symbol">:assignee_id</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="108-uniqueness-constraint-for-user-s-name"></a><a href="#108-uniqueness-constraint-for-user-s-name" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10.8 Uniqueness constraint for User's name</h2>
<p>Add uniqueness and presence constraint in the <code>User</code> model.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> &lt; ApplicationRecord</span>
  has_many <span class="hljs-symbol">:tasks</span>

  validates <span class="hljs-symbol">:name</span>, presence <span class="hljs-symbol">:true</span>, <span class="hljs-symbol">uniqueness:</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Here <code>uniqueness</code> helper validates that the attribute's value is unique right before the object gets saved.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="https://im-amitto.github.io/docusaures-website/docs/chapter_9"><span class="arrow-prev">← </span><span>Chapter 9 - Active Record Callbacks and Object Life Cycle</span></a><a class="docs-next button" href="https://im-amitto.github.io/docusaures-website/docs/chapter_11"><span>Chapter 11 - Authentication</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#101-add-a-user-model">10.1 Add a User model</a></li><li><a href="#102-create-migration">10.2 Create migration</a></li><li><a href="#103-defining-associations-betweek-task-and-user-models">10.3 Defining associations betweek Task and User models</a></li><li><a href="#104-create-new-user">10.4 Create new <code>user</code></a></li><li><a href="#105-update-new-task-form-to-assign-the-user-to-the-task">10.5 Update new task form to assign the user to the task</a></li><li><a href="#107-update-task-controller">10.7 Update task controller</a></li><li><a href="#108-uniqueness-constraint-for-user-s-name">10.8 Uniqueness constraint for User's name</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2019 BigBinary</section></footer></div></body></html>