<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Authentication · Learn Ruby on Rails</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;bcrypt-gem&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#bcrypt-gem&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Bcrypt gem.&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Authentication · Learn Ruby on Rails"/><meta property="og:type" content="website"/><meta property="og:url" content="https://im-amitto.github.io/https://im-amitto.github.io/docusaures-website/"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;bcrypt-gem&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#bcrypt-gem&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Bcrypt gem.&lt;/h2&gt;
"/><meta property="og:image" content="https://im-amitto.github.io/https://im-amitto.github.io/docusaures-website/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://im-amitto.github.io/https://im-amitto.github.io/docusaures-website/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="https://im-amitto.github.io/docusaures-website/img/logo.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="./../css/prism.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="./../js/prism.js"></script><script type="text/javascript" src="./../js/custom.js"></script><link rel="stylesheet" href="https://im-amitto.github.io/docusaures-website/css/main.css"/><script src="https://im-amitto.github.io/docusaures-website/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="https://im-amitto.github.io/docusaures-website/"><img class="logo" src="https://im-amitto.github.io/docusaures-website/img/logo.png" alt="Learn Ruby on Rails"/><h2 class="headerTitleWithLogo">Learn Ruby on Rails</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"></ul></nav></div></header></div></div><div class="navPusher singleRowMobileNav"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>book</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">book</h3><ul class=""><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/">Introduction</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-0.md">Installing Ruby on Rails and VSCode</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-1.md">Building a new Rails application</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-2.md">Getting started with Ruby on Rails</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-3.md">Task controller</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-4.md">Adding tasks through browser</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-5.md">Show a task</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-6.md">Update the task</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-7.md">Delete the task</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-8.md">Introduction to Validation</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-9.md">Active Record Callbacks and Object Life Cycle</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-10.md">Introducing User model</a></li><li class="navListItem navListItemActive"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-11.md">Authentication</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-12.md">Introduction to Authorization</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-13.md">State Management via Ajax</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-14.md">Adding comments to Tasks</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-15.md">Attaching files</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-16.md">Introduction to Testing and Writing Unit Tests</a></li><li class="navListItem"><a class="navItem" href="https://im-amitto.github.io/docusaures-website/docs/chapter-19.md">Configuring Queue Adapters for Background Processing</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Authentication</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="bcrypt-gem"></a><a href="#bcrypt-gem" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bcrypt gem.</h2>
<p>Authentication involves validating password provided by a user.
For security reasons passwords should be stored in an encrypted form rather than in plain text.
In case our database is ever compromised, user password would still remain secure.</p>
<p>The gem <code>bcpyt</code> uses an asymmetric algorithm thus encrypted string stored in DB is of no use to attacker.
Installing this gem is a piece of cake obviously.
Just uncomment/add following line from/to your <code>Gemfile</code></p>
<pre><code class="hljs css language-ruby">gem <span class="hljs-string">'bcrypt'</span>, <span class="hljs-string">'~&gt; 3.1.7'</span>
</code></pre>
<p>Now execute the command mentioned below.</p>
<pre><code class="hljs css language-bash">$ bundle install
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="add-credentials-fields-to-user-model"></a><a href="#add-credentials-fields-to-user-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add credentials fields to User model</h2>
<p>Now let's add 2 fields to <code>User</code> model.
First field will store username and the second field will store password.
Run following command to add a migration.</p>
<pre><code class="hljs css language-bash">$ rails g migration AddEmailAndPasswordDigestToUser
</code></pre>
<p>Now if we have a look at <code>taskmanager/db/migrate</code> directory, we can see a new file named <code>TIMESTAMP_add_email_and_password_digest_to_user.rb</code>.
We need to alter this file to direct our database as to what fields are to be added/removed/modified when this migration runs. Modify your file to match following</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddEmailAndPasswordDigestToUser</span> &lt; ActiveRecord::Migration[5.2]</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span>
    add_column <span class="hljs-symbol">:users</span>, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">:string</span>
    add_column <span class="hljs-symbol">:users</span>, <span class="hljs-symbol">:password_digest</span>, <span class="hljs-symbol">:string</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Now let's run the migration.</p>
<pre><code class="hljs css language-bash">$ rails db:migrate
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="user-has_secure_password"></a><a href="#user-has_secure_password" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>User has_secure_password</h2>
<p>Add following lines to <code>User</code> model.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> &lt; ApplicationRecord</span>
  <span class="hljs-comment"># ----- add these lines here: -----</span>
  has_secure_password

  <span class="hljs-comment"># Verify that email field is not blank and that it doesn't already exist in the db (prevents duplicates):</span>
  validates <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">presence:</span> <span class="hljs-literal">true</span>, <span class="hljs-symbol">uniqueness:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># ----- end of added lines -----</span>

  <span class="hljs-comment"># ----- previous code -------</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="flash-messages"></a><a href="#flash-messages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flash messages</h2>
<p>Add following lines to <code>app/views/layouts/application.html.erb</code>.</p>
<pre><code class="hljs css language-ruby">&lt;!DOCTYPE html&gt;
...
  &lt;body&gt;
    &lt;%# ----- add these lines here: ----- %&gt;

    &lt;% flash.each do |key, value| %&gt;
      &lt;div class="alert alert-&lt;%= key %&gt;"&gt;&lt;%= value %&gt;&lt;/div&gt;
    &lt;% end %&gt;

    &lt;%# ----- end of added lines ----- %&gt;

    &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The above added code will iterate through flash hash and print all messages. View file for any action is rendered with application layout by default. <code>&lt;%= yield %&gt;</code> will display that action's view file content in it's place.</p>
<h2><a class="anchor" aria-hidden="true" id="signup"></a><a href="#signup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Signup</h2>
<p>Let's implement user signup functionality to add users to our database.</p>
<h3><a class="anchor" aria-hidden="true" id="users-controller"></a><a href="#users-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Users controller</h3>
<p>Run following command to generate users controller file if not created already.</p>
<pre><code class="hljs css language-bash">$ rails g controller users
</code></pre>
<p>Now if we navigate to <code>app/controllers</code> directory we can see a file named <code>users_controller.rb</code>. Let's modify it.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersController</span> &lt; ApplicationController</span>

  <span class="hljs-comment"># Responsible for rendering new user view file and initializing resource to be used with user signup form helper</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span></span>
    @user = User.new
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># Responsible for handling form submit request</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>

    <span class="hljs-comment"># Creating user active record object from params</span>
    @user = User.new(user_params)

    <span class="hljs-comment"># If user save in the db is successful</span>
    <span class="hljs-keyword">if</span> @user.save
      flash[<span class="hljs-symbol">:notice</span>] = <span class="hljs-string">'Account created successfully!'</span>

      redirect_to root_path
    <span class="hljs-keyword">else</span>
      flash.now[<span class="hljs-symbol">:alert</span>] = @user.errors.full_messages.join(<span class="hljs-string">', '</span>)

      render <span class="hljs-symbol">:new</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

private

  <span class="hljs-comment"># Responsible for restricting params from user signup form.</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">user_params</span></span>
    params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:user</span>).permit(<span class="hljs-symbol">:name</span>, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">:password</span>, <span class="hljs-symbol">:password_confirmation</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>We received user details when signup form is submitted, we restrict those params in user_params method.
We create user active record object using these params
which will automatically assign values received in params to user attributes. Now you might have noticed these lines</p>
<p><code>flash[:notice] = &quot;Account created successfully!&quot;</code></p>
<p><code>flash.now[:alert] = @user.errors.full_messages.join(', ')</code></p>
<p>These lines are responsible for displaying messages on any page.
But we need to modify our view files to make use of them.
As of now these will be unused and we won't be able to see any message on our page.</p>
<p>Also another thing to note here is use of <code>flash</code>
if save is successful but using <code>flash.now</code> when unsuccessful.
Let's try to undertand these.</p>
<p>So when the save is successful we use <code>flash</code>, store our message in it and <code>redirect</code> to <code>users#new</code> page.
This flash message stays persistent for 1 request and since <code>redirect</code> is a new browser request altogether, this works.</p>
<p>But in case when save is unsucessful we use <code>flash.now</code>, which sets the message for current request.
As you would have noticed, we used <code>render :new</code> here and not <code>redirect</code>.
This will not be a new browser request but just rendering of view file <code>users/new.html.erb</code>.
But now the question arise we created a new dummy user active record object in new action <code>@user = User.new</code> for our signup form. But since we already have a <code>@user</code> variable here our signup form will use it.
And this <code>@user</code> object already has values assigned to its attributes our form fields will have prefilled values for those fields.
Minor rails magic but saves a great deal of effort when developing web functionalities!</p>
<h3><a class="anchor" aria-hidden="true" id="user-routes"></a><a href="#user-routes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>User routes</h3>
<p>Let's add user routes by modifying <code>taskmanager/config/routes.rb</code></p>
<pre><code class="hljs css language-ruby">Rails.application.routes.draw <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># ----- previous code -------</span>

  <span class="hljs-comment"># ----- add these lines here: -----</span>

  <span class="hljs-comment"># Add a root route if you don't have one...</span>
  <span class="hljs-comment"># We can even use some other controller and action as site root:</span>
  root <span class="hljs-symbol">to:</span> <span class="hljs-string">'users#new'</span>

  resources <span class="hljs-symbol">:users</span>, <span class="hljs-symbol">only:</span> [<span class="hljs-symbol">:new</span>, <span class="hljs-symbol">:create</span>]
  <span class="hljs-comment"># ----- end of added lines -----</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="new-user-view"></a><a href="#new-user-view" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>New user view</h3>
<p>We will need to create a view file for users controller new action.
This view file will display our user signup form.
Create a new file named <code>new.html.erb</code> in <code>taskmanager/app/views/users</code> directory.</p>
<pre><code class="hljs css language-ruby">&lt;h1&gt;Sign Up&lt;/h1&gt;

&lt;%= form_for @user do |f| %&gt;
  &lt;div&gt;
    &lt;%= f.label :name %&gt;
    &lt;%= f.text_field :name, autofocus: true %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= f.label :email %&gt;
    &lt;%= f.text_field :email %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= f.label :password %&gt;
    &lt;%= f.password_field :password %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= f.label :password_confirmation %&gt;
    &lt;%= f.password_field :password_confirmation %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= f.submit "Sign up!" %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="login"></a><a href="#login" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Login</h2>
<p>Lets use the credentials fields we added to authenticate and login a user.
We won't need a model for session as we will be storing it in cookie and interact with it using rails session object.</p>
<h3><a class="anchor" aria-hidden="true" id="sessions-controller"></a><a href="#sessions-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sessions controller</h3>
<p>Run following command to generate users controller file if not created already.</p>
<pre><code class="hljs css language-bash">$ rails g controller sessions
</code></pre>
<p>Now if we navigate to <code>taskmanager/app/controllers</code> directory we can see a file named <code>sessions_controller.rb</code>.
Let's modify it.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SessionsController</span> &lt; ApplicationController</span>
<span class="hljs-comment"># ----- add these lines here: -----</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span></span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    user = User.find_by(<span class="hljs-symbol">email:</span> params[<span class="hljs-symbol">:login</span>][<span class="hljs-symbol">:email</span>].downcase)

    <span class="hljs-comment"># If user exist in DB run has_secure_password's .authenticate()</span>
    <span class="hljs-keyword">if</span> user &amp;&amp; user.authenticate(params[<span class="hljs-symbol">:login</span>][<span class="hljs-symbol">:password</span>])
      <span class="hljs-comment"># Save the user.id in session cookie if password correct:</span>
      session[<span class="hljs-symbol">:user_id</span>] = user.id.to_s
      flash[<span class="hljs-symbol">:notice</span>] = <span class="hljs-string">'Successfully logged in!'</span>
      redirect_to root_path
    <span class="hljs-keyword">else</span>
      <span class="hljs-comment"># if email or password incorrect, re-render login page:</span>
      flash.now[<span class="hljs-symbol">:alert</span>] = <span class="hljs-string">'Incorrect credentials, try again.'</span>
      render <span class="hljs-symbol">:new</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  <span class="hljs-comment"># ----- end of added lines -----</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="session-routes"></a><a href="#session-routes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session routes</h3>
<p>Let's add session routes by modifying <code>taskmanager/config/routes.rb</code>.</p>
<pre><code class="hljs css language-ruby">Rails.application.routes.draw <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># ----- previous code -------</span>

  <span class="hljs-comment"># ----- add these lines here: -----</span>

  get <span class="hljs-string">'/login'</span>     =&gt; <span class="hljs-string">'sessions#new'</span>

  post <span class="hljs-string">'/login'</span>    =&gt; <span class="hljs-string">'sessions#create'</span>
    <span class="hljs-comment"># ----- end of added lines -----</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="session-views"></a><a href="#session-views" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session views</h3>
<p>We will need to create a view file for sessions controller new action.
This view file will display our user signup form.
Create a new file named <code>new.html.erb</code> in <code>taskmanager/app/views/sessions</code> directory.</p>
<pre><code class="hljs css language-ruby">&lt;h1&gt;Log In&lt;/h1&gt;
&lt;%= form_for :login do |f| %&gt;
  &lt;div&gt;
    &lt;%= f.label :email %&gt;
    &lt;%= f.text_field :email, autofocus: true %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= f.label :password %&gt;
    &lt;%= f.password_field :password %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= f.submit "Log In" %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="logout"></a><a href="#logout" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logout</h2>
<h3><a class="anchor" aria-hidden="true" id="sessions-controller-1"></a><a href="#sessions-controller-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sessions controller</h3>
<p>Navigate to <code>taskmanager/app/controllers/sessions_controller.rb</code> and modify it.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SessionsController</span> &lt; ApplicationController</span>
  <span class="hljs-comment"># ----- previous code -------</span>

  <span class="hljs-comment"># ----- add these lines here: -----</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">destroy</span></span>
    <span class="hljs-comment"># remove saved user_id from the cookie:</span>
    session.delete(<span class="hljs-symbol">:user_id</span>)
    alert[<span class="hljs-symbol">:notice</span>] = <span class="hljs-string">'Logged out!'</span>
    redirect_to login_path
  <span class="hljs-keyword">end</span>
  <span class="hljs-comment"># ----- end of added lines -----</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="session-routes-1"></a><a href="#session-routes-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session routes</h3>
<p>Let's add session routes by modifying <code>taskmanager/config/routes.rb</code>. Also, let's make the tasks list as the root route for our applicaiton.</p>
<pre><code class="hljs css language-ruby">Rails.application.routes.draw <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># ----- previous code -------</span>

  <span class="hljs-comment"># ----- add these lines here: -----</span>
  root <span class="hljs-symbol">to:</span> <span class="hljs-string">'tasks#index'</span>

  delete <span class="hljs-string">'/logout'</span> =&gt; <span class="hljs-string">'sessions#destroy'</span>
  <span class="hljs-comment"># ----- end of added lines -----</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>We observe that now if we go to our application and type <code>localhost:3000</code>, we see the list of our tasks.</p>
<h2><a class="anchor" aria-hidden="true" id="allow-user-to-view-tasks-only-if-logged-in"></a><a href="#allow-user-to-view-tasks-only-if-logged-in" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Allow user to view Tasks only if Logged In.</h2>
<p>Until now, the users were able so see tasks even without logging in.
Now let's restrict this behaviour and enable viewing tasks only when users are logged in.
The checks we'll have to carry out are as follows:</p>
<ol>
<li>If user is logged in, we do nothing and allow the application flow to lead the way.</li>
<li>If user is not logged in, we stop the application flow and redirect the user to the Log In page.</li>
</ol>
<p>To do this we can user <code>Filters</code> provided by Rails. <code>Filters</code> are methods that are run &quot;before&quot;, &quot;after&quot; or &quot;around&quot; a controller action. We would be using a <code>before</code> filter here as we want to check if the user is logged in or not before letting him view the tasks list.</p>
<p>Let's go to our Tasks Controller and add the required code.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TasksController</span> &lt; ApplicationController</span>
  <span class="hljs-comment"># ----- add the line here: -----</span>
  before_action <span class="hljs-symbol">:ensure_user_logged_in</span>
  <span class="hljs-comment"># ----- end of added line -----</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span></span>
    @tasks = Task.all
  <span class="hljs-keyword">end</span>
</code></pre>
<p>Now, the method <code>ensure_user_logged_in</code> will be defined in the Applcation Controller and by making it this way we can use the method <code>ensure_user_logged_in</code> in any of our future controllers as in Rails, all Controller classes inherit from Applicaiton controller.</p>
<p>Now let's go to our Application Controller and define the method <code>ensure_user_logged_in</code>. So here is the required code and other methods that need to be added.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationController</span> &lt; ActionController::Base</span>

  private
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ensure_user_logged_in</span></span>
      <span class="hljs-keyword">unless</span> logged_in?
        flash[<span class="hljs-symbol">:danger</span>] = <span class="hljs-string">"Please Log In to view the Tasks."</span>
        redirect_to new_login_path
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logged_in?</span></span>
      current_user.present?
    <span class="hljs-keyword">end</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">current_user</span></span>
      <span class="hljs-keyword">if</span> session[<span class="hljs-symbol">:user_id</span>]
        @current_user <span class="hljs-params">||</span>= User.find(session[<span class="hljs-symbol">:user_id</span>])
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Let's observe what's going on here.</p>
<ul>
<li><p>The control enters the method <code>ensure_user_logged_in</code> and from there it calls the method <code>logged_in?</code> which further calls the method <code>current_user</code>. The method <code>current_user</code> checks if our session[:user_id] exists and if it does, then the user having that <code>id</code> is set in the instance variable <code>current_user</code>. Don't get confused between <code>@current_user</code> and <code>current_user</code>. Former is an <code>instance variable</code> whereas latter is simply a <code>method name</code>.</p></li>
<li><p>Now the <code>logged_in?</code> method returns true or false depending if <code>current_user</code> method sets the value of instance variable <code>@current_user</code> or not.</p></li>
<li><p>Now this value gets returned to <code>ensure_user_logged_in</code> method which does nothing if the value received bu it is <code>true</code>
and otherwise if <code>false</code> it pushes a value in the <code>flash</code> hash and redirects the user to the <code>login</code> page.</p></li>
<li><p>After this, the application view will be rendered. Now, let's add some code to the applicaiton view file to display user's name if the current_user is set.</p></li>
</ul>
<pre><code class="hljs css language-ruby">  &lt;body&gt;
    &lt;% flash.each do |key, value| %&gt;
      &lt;div class="alert alert-&lt;%= key %&gt;"&gt;&lt;%= value %&gt;&lt;/div&gt;
    &lt;% end %&gt;
     # ----- previous code -------

     # ----- add these lines here: ----
    &lt;div id = "container"&gt;
      &lt;% if current_user %&gt;
        Hi &lt;%= current_user.name %&gt;
        &lt;br&gt;
        &lt;%= link_to "Logout", logout_path, method: :delete %&gt;
      &lt;% end %&gt;
      &lt;%= yield %&gt;
    &lt;/div&gt;
    # ----- end of added lines -----
  &lt;/body&gt;
</code></pre>
<ul>
<li>Yield here is used to insert the rendered view of the tasks' <code>index.html.erb</code> file.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="storing-information-of-who-created-the-task"></a><a href="#storing-information-of-who-created-the-task" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storing information of who created the task</h2>
<p>Let's add a new column <code>creator_id</code> to tasks table.
To add a new column to our existing table, we'll generate a new migration.</p>
<pre><code class="hljs css language-bash">$ rails g migration AddCreatorIdToTask :creator_id, :string
</code></pre>
<p>This would create a new file under the db/migrate folder. It should look something like this:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddCreatorIdToTask</span> &lt; ActiveRecord::Migration[5.2]</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span>
    add_column <span class="hljs-symbol">:tasks</span>, <span class="hljs-symbol">:creator_id</span>, <span class="hljs-symbol">:string</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The code already exists in the change method and the reason for that is that our migrattion is of the add_column_name_to_table_name column_name:type which Rails infers anf hence adds the code for that.</p>
<p>Now run</p>
<pre><code class="hljs css language-bash">$ rails db:migrate
</code></pre>
<p>And with this the migration is up and running.</p>
<h2><a class="anchor" aria-hidden="true" id="assinging-current_user-as-task-s-creator"></a><a href="#assinging-current_user-as-task-s-creator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Assinging current_user as task's creator</h2>
<p>Now, we always want the <code>creator_id</code> of a task to bet set as that of the <code>current_user</code>. To implement that, we need to make change to the create action of Tasks controller.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  @user = User.find(user_params[<span class="hljs-symbol">:user_id</span>])
  @task = @user.tasks.new(task_params)
  <span class="hljs-comment"># ----- previous code -------</span>

  <span class="hljs-comment"># ----- add these lines here: ----</span>
  @task.creator_id = current_user.id
  <span class="hljs-comment"># ----- end of added line -----</span>
</code></pre>
<p>With this change, the created task always has its creator_id set to that of the current_user.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="https://im-amitto.github.io/docusaures-website/docs/chapter-10.md"><span class="arrow-prev">← </span><span>Introducing User model</span></a><a class="docs-next button" href="https://im-amitto.github.io/docusaures-website/docs/chapter-12.md"><span>Introduction to Authorization</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#bcrypt-gem">Bcrypt gem.</a></li><li><a href="#add-credentials-fields-to-user-model">Add credentials fields to User model</a></li><li><a href="#user-has_secure_password">User has_secure_password</a></li><li><a href="#flash-messages">Flash messages</a></li><li><a href="#signup">Signup</a><ul class="toc-headings"><li><a href="#users-controller">Users controller</a></li><li><a href="#user-routes">User routes</a></li><li><a href="#new-user-view">New user view</a></li></ul></li><li><a href="#login">Login</a><ul class="toc-headings"><li><a href="#sessions-controller">Sessions controller</a></li><li><a href="#session-routes">Session routes</a></li><li><a href="#session-views">Session views</a></li></ul></li><li><a href="#logout">Logout</a><ul class="toc-headings"><li><a href="#sessions-controller-1">Sessions controller</a></li><li><a href="#session-routes-1">Session routes</a></li></ul></li><li><a href="#allow-user-to-view-tasks-only-if-logged-in">Allow user to view Tasks only if Logged In.</a></li><li><a href="#storing-information-of-who-created-the-task">Storing information of who created the task</a></li><li><a href="#assinging-current_user-as-task-s-creator">Assinging current_user as task's creator</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2019 BigBinary</section></footer></div></body></html>